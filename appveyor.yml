image:
 - Visual Studio 2017

environment:
  CURL_VERSION: 7.56.1
  CEF_VERSION: 3.3440.1805.gbe070f9

install:
  - git submodule update --init --recursive
  - cmd: C:\projects\obs-studio-webrtc\CI\install-script-win.cmd
  - cmd: c:\projects\obs-studio-webrtc\CI\configure-script-win.cmd

build_script:
# - cmake --build . --config Release
  - ctest -D Experimental -C Release
  - cpack

# before_deploy:
#  - cmd: C:\projects\obs-studio\CI\before-deploy-win.cmd

artifacts:
  path: .\build64\ebs-studio-x64-m73-travis-mac-122-gbf1c7d78-modified.exe
  name: ebs_nsis_pkg

deploy:
  provider: S3
  access_key_id: AKIAYXRCU62VF3RWPU57
  secret_access_key:
    secure: x+dbxIjNpCw+4vyHD/XGg0ecNcqWwE8EnPrcmoiAiE0CzhUQZ6p/wJGN+gXxlb3131a4YTyut3h8buFZbqftccinSVsSqzk+leB8jjrBEIJbwWI1/Sd9gRJjBsVY9WfoOsye6LZHEWgBxy2wdqgWfuDEDsuqm6wJAU6X7cxi9sKkMchVQ0HpE8Cv/M9veUXoQCnFo5ebZxEL/Mcl0CG26x/uJnZ4O7Bf+TWWhtGujSCTd+pIKl8E2nfU81kw4QLow8zZuWeOjOalJ1njOrw5uBR4HZb7ZQNNRYTNVn2SkvcUm/ICglwg9UJ3YcuSQM9I0J04GJWQAAVlB0svTN4KG0inLv7jAb8f3wfUFAJx5bDLWe47RsfXs4uHLgKzQupkvKBjMD/At2bngccRktuoOSqgrAFK0BccoXnInrKhyKttrSmCWYznKl2mi/qqfhJI1Y9r0sAh0Kzzu0zpLzBfz3A1RKC2Bi0B8IQ56zZTwG5bIXaAHPwqFe4SbquGksdipP+n7C1Dv7rFKCNalOKURU2Huftxp2RbeO9mpDpy4X5PRbwqPOpj28zQZkT6vvCcG2TfS9U0kPeLinZPDEybZxywwQP4Mu3/j3y1gyrylzE2gdBEaw5H3ChaLW2VG9IqIUBaOqtEDLsjDMgZrRjxwkQ8j+RxcChod3RxhJBPecM=
  bucket: ebs-build
  region: us-east-1
  folder: appveyor-builds
  artifact: ebs_nsis_pkg

test: off

cache:
  - dependencies2017.zip
  - vlc.zip
 # right now, we just remove this option which takes otherwise a lot of space
 # - 'cef_binary_%CEF_VERSION%_windows64.zip'
  - Qt_5.10.1.7z
  - libWebRTC-73-win.tar.gz
  - openssl-1.1.zip
